name: 药丸论坛签到

on:
  # 定时触发（每天9点执行，UTC时间1点 = 北京时间9点）
  schedule:
    - cron: '0 1 * * *'
  # 手动触发
  workflow_dispatch:

jobs:
  checkin:
    runs-on: ubuntu-latest
    outputs:
      checkin_result: ${{ steps.checkin_step.outputs.checkin_result }}
      checkin_msg: ${{ steps.checkin_step.outputs.checkin_msg }}
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: 执行签到脚本
        id: checkin_step
        env:
          INVITES_COOKIE: ${{ secrets.INVITES_COOKIE }}
        run: python checkin.py
      
      - name: 发送企业微信通知
        uses: chf007/action-wechat-work@master
        with:
         # 消息类型：text/markdown
         msgtype: markdown
         # Webhook 地址
         webhook: ${{ secrets.WECOM_WEBHOOK }}
         # 消息内容（支持 Markdown）
         content: |
           ### 药丸论坛签到通知
           > **状态**：${{ steps.checkin_step.outputs.checkin_result == 'success' && '✅ 签到成功' || '❌ 签到失败' }}
           > **详情**：${{ steps.checkin_step.outputs.checkin_msg }}
           > **时间**：${{ github.run_at }}
