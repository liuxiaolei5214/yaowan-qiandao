name: 药丸论坛签到

on:
  # 定时触发（每天9点执行，使用UTC时间，北京时间需要+8小时，所以设置为1点）
  schedule:
    - cron: '0 1 * * *'
  # 手动触发
  workflow_dispatch:

jobs:
  checkin:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@v4
      
      - name: 设置 Python 环境
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
      
      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install requests
      
      - name: 执行签到脚本
        env:
          INVITES_COOKIE: ${{ secrets.INVITES_COOKIE }}
        run: python checkin.py
      
      - name: 发送通知（可选）
        if: failure()
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.qq.com
          server_port: 465
          username: ${{ secrets.EMAIL_USERNAME }}
          password: ${{ secrets.EMAIL_PASSWORD }}
          subject: 药丸论坛签到失败通知
          body: 药丸论坛签到任务执行失败，请检查Cookie是否有效
          to: ${{ secrets.NOTIFY_EMAIL }}
          from: GitHub Actions
          secure: true
